

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Bugzilla mail with real names &mdash; JNRowe</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/icon.ico"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
        <link rel="copyright" title="Copyright" href="../../copyright.html"/>
    <link rel="top" title="JNRowe" href="../../index.html"/>
        <link rel="up" title="Tips" href="index.html"/>
        <link rel="next" title="Compiling C source in vim" href="Compiling_in_vim.html"/>
        <link rel="prev" title="Beyond simple tab completion" href="Beyond_tab_completion.html"/>
    <link rel="alternate" type="application/atom+xml" title="Updated items" href="/updates.atom" />

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> JNRowe
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../projects.html">Projects</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Articles</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../dropping_gentoo.html">Dropping Gentoo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dropping_gentoo_reflex.html">Dropping Gentoo reflex</a></li>
<li class="toctree-l2"><a class="reference internal" href="../fossil.html"><strong class="command">fossil</strong> experiments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mutt_config_snippets.html"><strong class="command">mutt</strong> configuration snippets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rcs.html">Introduction to <abbr title="GNU Revision Control System">RCS</abbr></a></li>
<li class="toctree-l2"><a class="reference internal" href="../tdd_distros.html"><abbr title="Test Driven Development">TDD</abbr> distro development</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#further-categories">Further categories</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Tips</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="BTS_as_a_task_manager.html"><abbr title="Bug Tracking System">BTS</abbr> as a task manager</a></li>
<li class="toctree-l4"><a class="reference internal" href="Beyond_tab_completion.html">Beyond simple tab completion</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Bugzilla mail with real names</a></li>
<li class="toctree-l4"><a class="reference internal" href="Compiling_in_vim.html">Compiling C source in vim</a></li>
<li class="toctree-l4"><a class="reference internal" href="Context_aware_diffs_with_git.html">Context aware diffs with git</a></li>
<li class="toctree-l4"><a class="reference internal" href="Custom_locations_in_the_GTK_filechooser.html">Custom keybindings in the GTK+ file dialogs</a></li>
<li class="toctree-l4"><a class="reference internal" href="Debugging_python_regexps.html">Debugging Python <abbr title="Regular Expression">RegEx</abbr></a></li>
<li class="toctree-l4"><a class="reference internal" href="Disabling_cursor_blinking_in_GTK.html">Disabling cursor blinking in GTK+</a></li>
<li class="toctree-l4"><a class="reference internal" href="Fancy_awesome_theming.html">Fancy awesome theming</a></li>
<li class="toctree-l4"><a class="reference internal" href="Finding_a_windows_owner.html">Finding a window’s owner</a></li>
<li class="toctree-l4"><a class="reference internal" href="Formatting_csv_files_in_the_shell.html">Formatting <abbr title="Comma Separated Values">CSV</abbr> files in the shell</a></li>
<li class="toctree-l4"><a class="reference internal" href="Gentoo_one_liners.html">Gentoo one liners</a></li>
<li class="toctree-l4"><a class="reference internal" href="Importing_gmail_filters_in_mutt.html">Importing gmail filters in mutt</a></li>
<li class="toctree-l4"><a class="reference internal" href="Instant_web_server.html">Instant web server</a></li>
<li class="toctree-l4"><a class="reference internal" href="Kick_me_birthday_reminders.html">“Kick me” birthday reminders</a></li>
<li class="toctree-l4"><a class="reference internal" href="Making_a_nice_home.html">Making a nice home</a></li>
<li class="toctree-l4"><a class="reference internal" href="Making_a_nice_home.html#permissions">Permissions</a></li>
<li class="toctree-l4"><a class="reference internal" href="Making_a_nice_home.html#vim-hacks">vim hacks</a></li>
<li class="toctree-l4"><a class="reference internal" href="Making_a_nice_home.html#documentation">Documentation</a></li>
<li class="toctree-l4"><a class="reference internal" href="Populating_sup_contacts_from_abook.html">Populating <strong class="command">sup</strong> contacts from abook</a></li>
<li class="toctree-l4"><a class="reference internal" href="Sharing_Xresources_between_systems.html">Sharing Xresources between systems</a></li>
<li class="toctree-l4"><a class="reference internal" href="Simple_notifications_in_awesome.html">Simple notifications in awesome</a></li>
<li class="toctree-l4"><a class="reference internal" href="Simple_notifications_in_awesome.html#window-creation-notifications">Window creation notifications</a></li>
<li class="toctree-l4"><a class="reference internal" href="Simple_notifications_in_awesome.html#network-notifications">Network notifications</a></li>
<li class="toctree-l4"><a class="reference internal" href="Theming_mutt.html">Theming mutt</a></li>
<li class="toctree-l4"><a class="reference internal" href="Three_mobile_broadband_in_linux.html">Three mobile broadband in Linux</a></li>
<li class="toctree-l4"><a class="reference internal" href="Toggling_settings_in_vim.html">Toggling settings in vim</a></li>
<li class="toctree-l4"><a class="reference internal" href="Uber_pink_prompts.html">Uber pink prompts</a></li>
<li class="toctree-l4"><a class="reference internal" href="Visual_vim_mode_identifier.html">Visual vim mode identifier</a></li>
<li class="toctree-l4"><a class="reference internal" href="Zsh_and_the_vcs.html">Zsh and the <abbr title="Version Control System">VCS</abbr></a></li>
<li class="toctree-l4"><a class="reference internal" href="emacs_gtk_shortcuts.html">Proper keyboard shortcuts in GTK+</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../probits/index.html">Project postmortems</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../thoughts/index.html">Thoughts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../colophon.html">Colophon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contact.html">Contact details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../consult.html">Consulting services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../copyright.html">Copyright information</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">JNRowe</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Articles</a> &raquo;</li>
        
          <li><a href="index.html">Tips</a> &raquo;</li>
        
      <li>Bugzilla mail with real names</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="bugzilla-mail-with-real-names">
<h1>Bugzilla mail with real names<a class="headerlink" href="#bugzilla-mail-with-real-names" title="Permalink to this headline">¶</a></h1>
<p>John Bateman rants on the EADS Linux list:</p>
<blockquote>
<div><p><a class="reference external" href="http://www.bugzilla.org">Bugzilla</a> annoys the hell out of me, why I can’t just choose “spoof
<em class="mailheader">From</em> address” in bugspam is beyond me.  It makes filtering
such a chore!!</p>
</div></blockquote>
<p>I agree, and I’ve long since decided to fix the problem locally.  There are
unfortunately a couple of small prerequisites for using my method that you may
not have.  The first is that you need to be able to filter the content of the
mail easily, and the second is that you install
<a class="reference external" href="http://www.spinnaker.de/lbdb/">lbdb</a>.</p>
<p><strong class="command">lbdb</strong> is a small tool designed for handling mail addresses in <a class="reference external" href="http://www.mutt.org">mutt</a>,
but it does not require you to use or even install <strong class="command">mutt</strong>.  What we
are going to do is use <strong class="command">lbdb</strong> and our own incoming mail to seed an
email-to-name database for our bugspam filtering.  We don’t even need to
configure lbdb to use it for our purposes, although I do recommend giving the
package a try even if you use another mail client.</p>
<p>The <strong class="command">lbdb</strong> tool we want to use is <strong class="command">lbdb-fetchaddr</strong> which is
designed to generate an address search database for the <strong class="command">lbdb</strong>
<code class="docutils literal"><span class="pre">m_inmail</span></code> method.  <strong class="command">lbdb-fetchaddr</strong> keeps a text database of all
the names, addresses and the last seen date of every address we pass through
it.  This allows our Bugzilla filter to work without us having to generate our
own email-to-name list assuming we receive mail from the bug commenter either
personally or on a list, at the cost of increased(albeit still negligible)
processing time.  I use <a class="reference external" href="http://www.courier-mta.org/maildrop/">maildrop</a> to filter my mail and to tell the
<strong class="command">maildrop</strong> <abbr title="Mail Delivery Agent">MDA</abbr> to update the
<strong class="command">lbdb</strong> database we add a simple rule to our <code class="file docutils literal"><span class="pre">~/.mailfilter</span></code>:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>if ($SIZE &lt; 32768)
    cc &#39;| lbdb-fetchaddr -d &quot;%FT%T%z&quot;&#39;
</pre></div>
</div>
<p>See <a class="reference external" href="http://gist.github.com/198021">gist #198021</a></p>
<p>This tells <strong class="command">maildrop</strong> to pass all mails less than 32k in size through
<strong class="command">lbdq-fetchaddr</strong>, and we specify a nice <abbr title="International Organization for Standardization">ISO</abbr>-8601 time format for
easy sorting and parsing should the need arise.  Now every mail that is
delivered with <strong class="command">maildrop</strong> and isn’t too large will have the sender
name and address recorded in <code class="file docutils literal"><span class="pre">~/.lbdb/m_inmail.list</span></code>.</p>
<p>Now on to the actual filtering script, which is is written in <a class="reference external" href="http://www.python.org/">Python</a>.  It only
uses modules from the Python standard library, so you don’t need to install
anything else.  I have tested it with 25000 unique entries in
<code class="file docutils literal"><span class="pre">~/.lbdb/m_inmail.list</span></code> and it still takes less than a thirtieth of
a second to run the filter on my desktop, so processing the database each time
we start up isn’t really an issue.  Also, the few small tests I’ve done suggest
that using “real” database engines doesn’t help and the only way to speed it up
significantly would be to write a small daemon to process the mail which seems
more than a little overkill to me.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="ch">#! /usr/bin/python3 -tt</span>

<span class="kn">from</span> <span class="nn">csv</span> <span class="kn">import</span> <span class="n">reader</span>
<span class="kn">from</span> <span class="nn">email</span> <span class="kn">import</span> <span class="n">message_from_file</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">expanduser</span>
<span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">stdin</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">&#39;~/.lbdb/m_inmail.list&#39;</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">lbdb</span> <span class="o">=</span> <span class="n">reader</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">addresses</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">rec</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">lbdb</span><span class="p">)</span>

<span class="n">message</span> <span class="o">=</span> <span class="n">message_from_file</span><span class="p">(</span><span class="n">stdin</span><span class="p">)</span>

<span class="n">commenter</span> <span class="o">=</span> <span class="bp">None</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">message</span><span class="o">.</span><span class="n">get_payload</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39; changed:&#39;</span><span class="p">):</span>
        <span class="n">commenter</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">break</span>
    <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;------- Comment #&#39;</span><span class="p">):</span>
        <span class="n">commenter</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">4</span><span class="p">]</span>
        <span class="k">break</span>
    <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;        ReportedBy: &#39;</span><span class="p">):</span>
        <span class="n">commenter</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">break</span>

<span class="c1"># You could also filter the message content at this point if you wished.</span>
<span class="c1"># The following, for example, would remove the “https” link and some of</span>
<span class="c1"># the blank lines in Gentoo bugspam</span>
<span class="n">message</span><span class="o">.</span><span class="n">set_payload</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">message</span><span class="o">.</span><span class="n">get_payload</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()[</span><span class="mi">3</span><span class="p">],</span> <span class="p">]</span>
                            <span class="o">+</span> <span class="n">message</span><span class="o">.</span><span class="n">get_payload</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()[</span><span class="mi">6</span><span class="p">:]))</span>

<span class="k">if</span> <span class="n">commenter</span> <span class="ow">in</span> <span class="n">addresses</span><span class="p">:</span>
    <span class="n">message</span><span class="o">.</span><span class="n">replace_header</span><span class="p">(</span><span class="s1">&#39;from&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;&quot;</span><span class="si">%s</span><span class="s1">&quot; &lt;</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">addresses</span><span class="p">[</span><span class="n">commenter</span><span class="p">],</span> <span class="n">commenter</span><span class="p">))</span>

<span class="k">print</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">as_string</span><span class="p">())</span>
</pre></div>
</div>
<p>See <a class="reference external" href="http://gist.github.com/198022">gist #198022</a></p>
<p>The final addition to our <code class="file docutils literal"><span class="pre">~/.mailfilter</span></code> file enables our little Python
filter to process mail from Bugzilla and change its <em class="mailheader">From</em> address
if we have the information in the <code class="file docutils literal"><span class="pre">~/.lbdb/m_inmail.list</span></code> database.</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>if (/^From: bugzilla-daemon@/)
{
    xfilter &quot;~/.mailfilter.d/rewrite-name.py&quot;
    to Mail/Gentoo-bugs
}
</pre></div>
</div>
<p>See <a class="reference external" href="http://gist.github.com/198023">gist #198023</a></p>
<p>And from now on, or at least once your <code class="docutils literal"><span class="pre">m_inmail.list</span></code> is sufficiently seeded,
your bugspam will have the commenter’s name and email address, making it much
easier to filter and process it in your favourite mail client.</p>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Compiling_in_vim.html" class="btn btn-neutral float-right" title="Compiling C source in vim" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Beyond_tab_completion.html" class="btn btn-neutral" title="Beyond simple tab completion" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; <a href="../../copyright.html">Copyright</a> 2009-2017  James Rowe.
      Last updated on &#39;2017-12-09 [e8fa873]&#39;.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0.1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  false,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>