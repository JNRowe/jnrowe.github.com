

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Importing gmail filters in mutt &mdash; JNRowe</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/icon.ico"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
        <link rel="copyright" title="Copyright" href="../../copyright.html"/>
    <link rel="top" title="JNRowe" href="../../index.html"/>
        <link rel="up" title="Tips" href="index.html"/>
        <link rel="next" title="Instant web server" href="Instant_web_server.html"/>
        <link rel="prev" title="Gentoo one liners" href="Gentoo_one_liners.html"/>
    <link rel="alternate" type="application/atom+xml" title="Updated items" href="/updates.atom" />

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> JNRowe
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../projects.html">Projects</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Articles</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../dropping_gentoo.html">Dropping Gentoo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dropping_gentoo_reflex.html">Dropping Gentoo reflex</a></li>
<li class="toctree-l2"><a class="reference internal" href="../fossil.html"><strong class="command">fossil</strong> experiments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mutt_config_snippets.html"><strong class="command">mutt</strong> configuration snippets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rcs.html">Introduction to <abbr title="GNU Revision Control System">RCS</abbr></a></li>
<li class="toctree-l2"><a class="reference internal" href="../tdd_distros.html"><abbr title="Test Driven Development">TDD</abbr> distro development</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#further-categories">Further categories</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Tips</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="BTS_as_a_task_manager.html"><abbr title="Bug Tracking System">BTS</abbr> as a task manager</a></li>
<li class="toctree-l4"><a class="reference internal" href="Beyond_tab_completion.html">Beyond simple tab completion</a></li>
<li class="toctree-l4"><a class="reference internal" href="Bugzilla_real_names.html">Bugzilla mail with real names</a></li>
<li class="toctree-l4"><a class="reference internal" href="Compiling_in_vim.html">Compiling C source in vim</a></li>
<li class="toctree-l4"><a class="reference internal" href="Context_aware_diffs_with_git.html">Context aware diffs with git</a></li>
<li class="toctree-l4"><a class="reference internal" href="Custom_locations_in_the_GTK_filechooser.html">Custom keybindings in the GTK+ file dialogs</a></li>
<li class="toctree-l4"><a class="reference internal" href="Debugging_python_regexps.html">Debugging Python <abbr title="Regular Expression">RegEx</abbr></a></li>
<li class="toctree-l4"><a class="reference internal" href="Disabling_cursor_blinking_in_GTK.html">Disabling cursor blinking in GTK+</a></li>
<li class="toctree-l4"><a class="reference internal" href="Fancy_awesome_theming.html">Fancy awesome theming</a></li>
<li class="toctree-l4"><a class="reference internal" href="Finding_a_windows_owner.html">Finding a window’s owner</a></li>
<li class="toctree-l4"><a class="reference internal" href="Formatting_csv_files_in_the_shell.html">Formatting <abbr title="Comma Separated Values">CSV</abbr> files in the shell</a></li>
<li class="toctree-l4"><a class="reference internal" href="Gentoo_one_liners.html">Gentoo one liners</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Importing gmail filters in mutt</a></li>
<li class="toctree-l4"><a class="reference internal" href="Instant_web_server.html">Instant web server</a></li>
<li class="toctree-l4"><a class="reference internal" href="Kick_me_birthday_reminders.html">“Kick me” birthday reminders</a></li>
<li class="toctree-l4"><a class="reference internal" href="Making_a_nice_home.html">Making a nice home</a></li>
<li class="toctree-l4"><a class="reference internal" href="Making_a_nice_home.html#permissions">Permissions</a></li>
<li class="toctree-l4"><a class="reference internal" href="Making_a_nice_home.html#vim-hacks">vim hacks</a></li>
<li class="toctree-l4"><a class="reference internal" href="Making_a_nice_home.html#documentation">Documentation</a></li>
<li class="toctree-l4"><a class="reference internal" href="Populating_sup_contacts_from_abook.html">Populating <strong class="command">sup</strong> contacts from abook</a></li>
<li class="toctree-l4"><a class="reference internal" href="Sharing_Xresources_between_systems.html">Sharing Xresources between systems</a></li>
<li class="toctree-l4"><a class="reference internal" href="Simple_notifications_in_awesome.html">Simple notifications in awesome</a></li>
<li class="toctree-l4"><a class="reference internal" href="Simple_notifications_in_awesome.html#window-creation-notifications">Window creation notifications</a></li>
<li class="toctree-l4"><a class="reference internal" href="Simple_notifications_in_awesome.html#network-notifications">Network notifications</a></li>
<li class="toctree-l4"><a class="reference internal" href="Theming_mutt.html">Theming mutt</a></li>
<li class="toctree-l4"><a class="reference internal" href="Three_mobile_broadband_in_linux.html">Three mobile broadband in Linux</a></li>
<li class="toctree-l4"><a class="reference internal" href="Toggling_settings_in_vim.html">Toggling settings in vim</a></li>
<li class="toctree-l4"><a class="reference internal" href="Uber_pink_prompts.html">Uber pink prompts</a></li>
<li class="toctree-l4"><a class="reference internal" href="Visual_vim_mode_identifier.html">Visual vim mode identifier</a></li>
<li class="toctree-l4"><a class="reference internal" href="Zsh_and_the_vcs.html">Zsh and the <abbr title="Version Control System">VCS</abbr></a></li>
<li class="toctree-l4"><a class="reference internal" href="emacs_gtk_shortcuts.html">Proper keyboard shortcuts in GTK+</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../probits/index.html">Project postmortems</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../thoughts/index.html">Thoughts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../colophon.html">Colophon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contact.html">Contact details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../consult.html">Consulting services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../copyright.html">Copyright information</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">JNRowe</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Articles</a> &raquo;</li>
        
          <li><a href="index.html">Tips</a> &raquo;</li>
        
      <li>Importing gmail filters in mutt</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="importing-gmail-filters-in-mutt">
<h1>Importing gmail filters in mutt<a class="headerlink" href="#importing-gmail-filters-in-mutt" title="Permalink to this headline">¶</a></h1>
<p>On our company’s Linux list Ryan Abbott is preparing to move to <a class="reference external" href="http://www.mutt.org/">mutt</a>:</p>
<blockquote>
<div><p>I have some user filters setup in <a class="reference external" href="https://mail.google.com">gmail</a>, and I’m wondering if there some
way to make mutt use them?</p>
</div></blockquote>
<p>Ryan has some filters set up for “premium” users who should be tagged in
a special way in the mail display so that they are much more noticeable.  Google
do support <a class="reference external" href="http://gmailblog.blogspot.com/2009/03/new-in-labs-filter-importexport.html">exporting filters</a> now, and conveniently it is in well documented
format based on <a class="reference external" href="http://www.atomenabled.org/">Atom</a>.  An example export, gleaned from Ryan but with personal
data removed, follows:</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&#39;1.0&#39; encoding=&#39;UTF-8&#39;?&gt;</span><span class="nt">&lt;feed</span> <span class="na">xmlns=</span><span class="s">&#39;http://www.w3.org/2005/Atom&#39;</span> <span class="na">xmlns:apps=</span><span class="s">&#39;http://schemas.google.com/apps/2006&#39;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span>Priority filter<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;id&gt;</span>tag:mail.google.com,2008:filters:1255006471524,31130756565258<span class="nt">&lt;/id&gt;</span>
    <span class="nt">&lt;updated&gt;</span>2009-10-02T12:04:00Z<span class="nt">&lt;/updated&gt;</span>
    <span class="nt">&lt;author&gt;</span>
        <span class="nt">&lt;name&gt;</span>Ryan Abbott<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;email&gt;</span>rabbott@example.com<span class="nt">&lt;/email&gt;</span>
        <span class="nt">&lt;uri&gt;</span>http://rabbott.example.com<span class="nt">&lt;/uri&gt;</span>
    <span class="nt">&lt;/author&gt;</span>
    <span class="nt">&lt;entry&gt;</span>
        <span class="nt">&lt;category</span> <span class="na">term=</span><span class="s">&#39;filter&#39;</span><span class="nt">&gt;&lt;/category&gt;</span>
        <span class="nt">&lt;title&gt;</span>Joe Bloggs<span class="nt">&lt;/title&gt;</span>
        <span class="nt">&lt;id&gt;</span>tag:mail.google.com,2008:filter:1255006471524<span class="nt">&lt;/id&gt;</span>
        <span class="nt">&lt;updated&gt;</span>2009-10-01T09:23:11Z<span class="nt">&lt;/updated&gt;</span>
        <span class="nt">&lt;content&gt;&lt;/content&gt;</span>
        <span class="nt">&lt;apps:property</span> <span class="na">name=</span><span class="s">&#39;from&#39;</span> <span class="na">value=</span><span class="s">&#39;joe@example.com&#39;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;apps:property</span> <span class="na">name=</span><span class="s">&#39;label&#39;</span> <span class="na">value=</span><span class="s">&#39;HiPri&#39;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/entry&gt;</span>
    <span class="nt">&lt;entry&gt;</span>
        <span class="nt">&lt;category</span> <span class="na">term=</span><span class="s">&#39;filter&#39;</span><span class="nt">&gt;&lt;/category&gt;</span>
        <span class="nt">&lt;title&gt;</span>John Doe<span class="nt">&lt;/title&gt;</span>
        <span class="nt">&lt;id&gt;</span>tag:mail.google.com,2008:filter:31130756565258<span class="nt">&lt;/id&gt;</span>
        <span class="nt">&lt;updated&gt;</span>2009-09-23T14:59:45Z<span class="nt">&lt;/updated&gt;</span>
        <span class="nt">&lt;content&gt;&lt;/content&gt;</span>
        <span class="nt">&lt;apps:property</span> <span class="na">name=</span><span class="s">&#39;from&#39;</span> <span class="na">value=</span><span class="s">&#39;johndoe@example.com&#39;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;apps:property</span> <span class="na">name=</span><span class="s">&#39;label&#39;</span> <span class="na">value=</span><span class="s">&#39;HiPri&#39;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/entry&gt;</span>
<span class="nt">&lt;/feed&gt;</span>
</pre></div>
</div>
<p>The exported filter is actually quite nice and we could just pull the email
addresses out with <a class="reference external" href="http://sed.sourceforge.net/">sed</a>:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> sed -n <span class="s2">&quot;/name=&#39;from&#39;/s,^.*value=&#39;\([^&#39;]\+\)&#39;.*</span>$<span class="s2">,\1,p&quot;</span> filter.xml
<span class="go">joe@example.com</span>
<span class="go">johndoe@example.com</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>You shouldn’t parse <abbr title="Extensible Markup Language">XML</abbr> with tools like <strong class="command">sed</strong> or <strong class="command">awk</strong>.
There are plenty of <abbr title="Extensible Markup Language">XML</abbr> processing tools available, and unlike
<strong class="command">sed</strong> they shouldn’t fail with files that contain namespaces or
other <abbr title="Extensible Markup Language">XML</abbr> features.  Now I’ve said that, carry on using <strong class="command">sed</strong>
like I often do ;)</p>
</div>
<p>Once we have some way of getting at the email addresses we just need to add the
filters to <strong class="command">mutt</strong>.  For those of us who use <strong class="command">mutt</strong> the normal
approach to prioritising in the gmail way is to use either <a class="reference external" href="http://www.mutt.org/doc/manual/manual-3.html#ss3.7">colouring</a> or
<a class="reference external" href="http://www.mutt.org/doc/manual/manual-3.html#ss3.22">scoring</a>:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>color index brightgreen default ~fjoe@example.com
score ~fjohndoe@example.com +20
set index_format=&quot;%Z %2N %?H?%-16.12H&amp;%D? %-16.16F  %s&quot;
</pre></div>
</div>
<img alt="colouring and scoring in mutt" src="../../_images/2009-10-08-mutt_screenshot.png" />
<p>The <code class="docutils literal"><span class="pre">color</span></code> example sets all mail from the fictitious Joe Bloggs in the mail
index to use a bright green foreground and the default background colour.  The
<code class="docutils literal"><span class="pre">score</span></code> example adds another 20 points to mail from John Doe, we add it
instead of setting it directly is so that we can make use cumulative scoring.
We must make sure we include <code class="docutils literal"><span class="pre">%N</span></code> in our <a class="reference external" href="http://www.mutt.org/doc/manual/manual-6.html#index_format">index_format</a> setting to see the
scores in the mail index, the above <code class="docutils literal"><span class="pre">index_format</span></code> setting is the one
I currently use and it can be seen in the screenshot above.</p>
<p>I’m sure we’d prefer to automate the generation of the rules, and we can
quickly generate a list for <strong class="command">mutt</strong> using our favourite <abbr title="Extensible Markup Language">XML</abbr>
processing tool.  Today I’m using <a class="reference external" href="http://www.ruby-lang.org/">ruby</a>, because I know it is installed on
Ryan’s system.  We’re going to keep the identifier data from the Google export
just in case we decide to export our rules from <strong class="command">mutt</strong> at some point
in the future:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="nb">require</span> <span class="s1">&#39;rexml/document&#39;</span>
<span class="n">doc</span> <span class="o">=</span> <span class="no">REXML</span><span class="o">::</span><span class="no">Document</span><span class="o">.</span><span class="n">new</span> <span class="no">File</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">ARGV</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">)</span>

<span class="n">doc</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">each</span><span class="p">(</span><span class="s1">&#39;feed/entry&#39;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">entry</span><span class="o">|</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">elements</span><span class="o">[</span><span class="s2">&quot;id&quot;</span><span class="o">].</span><span class="n">text</span>
    <span class="nb">name</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">elements</span><span class="o">[</span><span class="s2">&quot;title&quot;</span><span class="o">].</span><span class="n">text</span>
    <span class="n">addy</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">elements</span><span class="o">[</span><span class="s2">&quot;apps:property&quot;</span><span class="o">].</span><span class="n">attributes</span><span class="o">[</span><span class="s2">&quot;value&quot;</span><span class="o">]</span>
    <span class="nb">puts</span> <span class="s2">&quot;# </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">, </span><span class="si">#{</span><span class="nb">id</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="nb">puts</span> <span class="s2">&quot;score ~f</span><span class="si">#{</span><span class="n">addy</span><span class="si">}</span><span class="s2"> 20&quot;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Calling that script on the example data from above yields a small
<strong class="command">mutt</strong> configuration file that we can include in our mutt setup by
adding <code class="docutils literal"><span class="pre">source</span> <span class="pre">&lt;file_location&gt;</span></code> to our <code class="file docutils literal"><span class="pre">~/.muttrc</span></code>.</p>
<div class="highlight-text"><div class="highlight"><pre><span></span># Joe Bloggs, tag:mail.google.com,2008:filter:1255006471524
score ~fjoe@example.com -20
# John Doe, tag:mail.google.com,2008:filter:31130756565258
score ~fjohndoe@example.com -20
</pre></div>
</div>
<p>A few years ago I posted some of tricks and tips I use for <a class="reference external" href="http://www.jnrowe.ukfsn.org/articles/configs/mutt.html">configuring mutt</a>,
which include some neat ways to colour and score mail on a per-folder basis.  It
may be worth taking a quick look at if you use folders to organise your mails.</p>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Instant_web_server.html" class="btn btn-neutral float-right" title="Instant web server" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Gentoo_one_liners.html" class="btn btn-neutral" title="Gentoo one liners" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; <a href="../../copyright.html">Copyright</a> 2009-2018  James Rowe.
      Last updated on &#39;2018-01-24 [cb31e9e]&#39;.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0.1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  false,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>