<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Importing gmail filters in mutt &mdash; JNRowe</title>
    
    <link rel="stylesheet" href="../../_static/agogo.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/icon.ico"/>
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="top" title="JNRowe" href="../../index.html" />
    <link rel="up" title="Tips" href="index.html" />
    <link rel="next" title="Instant web server" href="Instant_web_server.html" />
    <link rel="prev" title="Gentoo one liners" href="Gentoo_one_liners.html" />
    <link rel="alternate" type="application/atom+xml" title="Updated items" href="/updates.atom" />
  </head>
  <body>
    <div class="header-wrapper">
      <div class="header">
          <p class="logo"><a href="../../index.html">
            <img class="logo" src="../../_static/logo.png" alt="Logo"/>
          </a></p>
        <div class="headertitle"><a
          href="../../index.html">JNRowe</a></div>
        <div class="rel">
          <a href="Gentoo_one_liners.html" title="Gentoo one liners"
             accesskey="P">previous</a> |
          <a href="Instant_web_server.html" title="Instant web server"
             accesskey="N">next</a> |
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a>
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="document">
    <div class="admonition note">
        <p class="first admonition-title">
            Estimated reading time: 4 minutes
        </p>
    </div>
    
    
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="importing-gmail-filters-in-mutt">
<h1>Importing gmail filters in mutt<a class="headerlink" href="#importing-gmail-filters-in-mutt" title="Permalink to this headline">Â¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">date:</th><td class="field-body">2009-10-08</td>
</tr>
</tbody>
</table>
<p>On our company&#8217;s Linux list Ryan Abbott is preparing to move to
<a class="reference external" href="http://www.mutt.org/">mutt</a>:</p>
<blockquote>
<div>I have some user filters setup in <a class="reference external" href="https://mail.google.com">gmail</a>, and I&#8217;m wondering if there some
way to make mutt use them?</div></blockquote>
<p>Ryan has some filters set up for &#8220;premium&#8221; users who should be tagged in
a special way in the mail display so that they are much more noticeable.  Google
do support <a class="reference external" href="http://gmailblog.blogspot.com/2009/03/new-in-labs-filter-importexport.html">exporting filters</a> now, and conveniently it is in well documented
format based on <a class="reference external" href="http://www.atomenabled.org/">Atom</a>.  An example export, gleaned from Ryan but with personal
data removed, follows:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&#39;1.0&#39; encoding=&#39;UTF-8&#39;?&gt;</span><span class="nt">&lt;feed</span> <span class="na">xmlns=</span><span class="s">&#39;http://www.w3.org/2005/Atom&#39;</span> <span class="na">xmlns:apps=</span><span class="s">&#39;http://schemas.google.com/apps/2006&#39;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span>Priority filter<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;id&gt;</span>tag:mail.google.com,2008:filters:1255006471524,31130756565258<span class="nt">&lt;/id&gt;</span>
    <span class="nt">&lt;updated&gt;</span>2009-10-02T12:04:00Z<span class="nt">&lt;/updated&gt;</span>
    <span class="nt">&lt;author&gt;</span>
        <span class="nt">&lt;name&gt;</span>Ryan Abbott<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;email&gt;</span>rabbott@example.com<span class="nt">&lt;/email&gt;</span>
        <span class="nt">&lt;uri&gt;</span>http://rabbott.example.com<span class="nt">&lt;/uri&gt;</span>
    <span class="nt">&lt;/author&gt;</span>
    <span class="nt">&lt;entry&gt;</span>
        <span class="nt">&lt;category</span> <span class="na">term=</span><span class="s">&#39;filter&#39;</span><span class="nt">&gt;&lt;/category&gt;</span>
        <span class="nt">&lt;title&gt;</span>Joe Bloggs<span class="nt">&lt;/title&gt;</span>
        <span class="nt">&lt;id&gt;</span>tag:mail.google.com,2008:filter:1255006471524<span class="nt">&lt;/id&gt;</span>
        <span class="nt">&lt;updated&gt;</span>2009-10-01T09:23:11Z<span class="nt">&lt;/updated&gt;</span>
        <span class="nt">&lt;content&gt;&lt;/content&gt;</span>
        <span class="nt">&lt;apps:property</span> <span class="na">name=</span><span class="s">&#39;from&#39;</span> <span class="na">value=</span><span class="s">&#39;joe@example.com&#39;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;apps:property</span> <span class="na">name=</span><span class="s">&#39;label&#39;</span> <span class="na">value=</span><span class="s">&#39;HiPri&#39;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/entry&gt;</span>
    <span class="nt">&lt;entry&gt;</span>
        <span class="nt">&lt;category</span> <span class="na">term=</span><span class="s">&#39;filter&#39;</span><span class="nt">&gt;&lt;/category&gt;</span>
        <span class="nt">&lt;title&gt;</span>John Doe<span class="nt">&lt;/title&gt;</span>
        <span class="nt">&lt;id&gt;</span>tag:mail.google.com,2008:filter:31130756565258<span class="nt">&lt;/id&gt;</span>
        <span class="nt">&lt;updated&gt;</span>2009-09-23T14:59:45Z<span class="nt">&lt;/updated&gt;</span>
        <span class="nt">&lt;content&gt;&lt;/content&gt;</span>
        <span class="nt">&lt;apps:property</span> <span class="na">name=</span><span class="s">&#39;from&#39;</span> <span class="na">value=</span><span class="s">&#39;johndoe@example.com&#39;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;apps:property</span> <span class="na">name=</span><span class="s">&#39;label&#39;</span> <span class="na">value=</span><span class="s">&#39;HiPri&#39;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/entry&gt;</span>
<span class="nt">&lt;/feed&gt;</span>
</pre></div>
</div>
<p>The exported filter is actually quite nice and we could just pull the email
addresses out with <a class="reference external" href="http://sed.sourceforge.net/">sed</a>:</p>
<div class="highlight-text"><div class="highlight"><pre>$ sed -n &quot;/name=&#39;from&#39;/s,^.*value=&#39;\([^&#39;]\+\)&#39;.*$,\1,p&quot; filter.xml
joe@example.com
johndoe@example.com
</pre></div>
</div>
<p>Once we have some way of getting at the email addresses we just need to add the
filters to <tt class="docutils literal"><span class="pre">mutt</span></tt>.  For those of us who use <tt class="docutils literal"><span class="pre">mutt</span></tt> the normal approach to
prioritising in the gmail way is to use either <a class="reference external" href="http://www.mutt.org/doc/manual/manual-3.html#ss3.7">colouring</a> or <a class="reference external" href="http://www.mutt.org/doc/manual/manual-3.html#ss3.22">scoring</a>:</p>
<div class="highlight-text"><div class="highlight"><pre>color index brightgreen default ~fjoe@example.com
score ~fjohndoe@example.com +20
set index_format=&quot;%Z %2N %?H?%-16.12H&amp;%D? %-16.16F  %s&quot;
</pre></div>
</div>
<img alt="colouring and scoring in mutt" src="../../_images/2009-10-08-mutt_screenshot.png" />
<p>The <tt class="docutils literal"><span class="pre">color</span></tt> example sets all mail from the fictitious Joe Bloggs in the mail
index to use a bright green foreground and the default background colour.  The
<tt class="docutils literal"><span class="pre">score</span></tt> example adds another 20 points to mail from John Doe, we add it
instead of settings it directly so that we can make use cumulative scoring.  We
must make sure we include <tt class="docutils literal"><span class="pre">%N</span></tt> in our <a class="reference external" href="http://www.mutt.org/doc/manual/manual-6.html#index_format">index_format</a> setting to see the scores
in the mail index, the above <tt class="docutils literal"><span class="pre">index_format</span></tt> setting is the one I currently use
and it can be seen in the screenshot on the right.</p>
<p>I&#8217;m sure we&#8217;d prefer to automate the generation of the rules, and we can quickly
generate a list for <tt class="docutils literal"><span class="pre">mutt</span></tt> using our favourite XML processing tool.  Today I&#8217;m
using <a class="reference external" href="http://www.ruby-lang.org/">ruby</a>, because I know it is installed on Ryan&#8217;s system.  We&#8217;re going to
keep the identifier data from the Google export just in case we decide to
re-import our rules from <tt class="docutils literal"><span class="pre">mutt</span></tt> at some point in the future:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;rexml/document&#39;</span>
<span class="n">doc</span> <span class="o">=</span> <span class="ss">REXML</span><span class="p">:</span><span class="ss">:Document</span><span class="o">.</span><span class="n">new</span> <span class="no">File</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">ARGV</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">)</span>

<span class="n">doc</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">each</span><span class="p">(</span><span class="s1">&#39;feed/entry&#39;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">entry</span><span class="o">|</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">elements</span><span class="o">[</span><span class="s2">&quot;id&quot;</span><span class="o">].</span><span class="n">text</span>
    <span class="nb">name</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">elements</span><span class="o">[</span><span class="s2">&quot;title&quot;</span><span class="o">].</span><span class="n">text</span>
    <span class="n">addy</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">elements</span><span class="o">[</span><span class="s2">&quot;apps:property&quot;</span><span class="o">].</span><span class="n">attributes</span><span class="o">[</span><span class="s2">&quot;value&quot;</span><span class="o">]</span>
    <span class="nb">puts</span> <span class="s2">&quot;# </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">, </span><span class="si">#{</span><span class="nb">id</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="nb">puts</span> <span class="s2">&quot;score ~f</span><span class="si">#{</span><span class="n">addy</span><span class="si">}</span><span class="s2"> 20&quot;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><a class="reference external" href="http://gist.github.com/205052">Fork this code</a></p>
<p>Calling that script on the example data from above yields a small <tt class="docutils literal"><span class="pre">mutt</span></tt>
configuration file that we can include in our mutt setup by adding <tt class="docutils literal"><span class="pre">source</span>
<span class="pre">&lt;file_location&gt;</span></tt> to our <tt class="docutils literal"><span class="pre">~/.muttrc</span></tt>.</p>
<div class="highlight-text"><div class="highlight"><pre># Joe Bloggs, tag:mail.google.com,2008:filter:1255006471524
score ~fjoe@example.com -20
# John Doe, tag:mail.google.com,2008:filter:31130756565258
score ~fjohndoe@example.com -20
</pre></div>
</div>
<p>A few years ago I posted some of tricks and tips I use for <a class="reference external" href="http://www.jnrowe.ukfsn.org/articles/configs/mutt.html">configuring mutt</a>,
which include some neat ways to colour and score mail on a per-folder basis.  It
may be worth taking a quick look at if you use folders to organise your mails.</p>
</div>


          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
          <h3>Table Of Contents</h3>
          <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../projects.html">Projects</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Articles</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Tips</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dopplr_effects.html">Dopplr defects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../important_balance.html">Murdering morality with ferocious fire</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nice_stories.html">Tell me a nice story, please</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rcs.html">Introduction to RCS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reset_in_ten.html">Hitting life&#8217;s reset button</a></li>
<li class="toctree-l2"><a class="reference internal" href="../side_projects.html">Side-projects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tdd_distros.html">TDD distro development</a></li>
<li class="toctree-l2"><a class="reference internal" href="../the_returned.html">Return to rambling</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../colophon.html">Colophon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contact.html">Contact details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../consult.html">Consulting services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../copyright.html">Copyright information</a></li>
</ul>

          <h3 style="margin-top: 1.5em;">Search</h3>
          <form class="search" action="../../search.html" method="get">
            <input type="text" name="q" />
            <input type="submit" value="Go" />
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
          </form>
          <p class="searchtip" style="font-size: 90%">
            Enter search terms or a module, class or function name.
          </p>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <a href="Gentoo_one_liners.html" title="Gentoo one liners"
             >previous</a> |
          <a href="Instant_web_server.html" title="Instant web server"
             >next</a> |
          <a href="../../genindex.html" title="General Index"
             >index</a>
            <br/>
            <a href="../../_sources/articles/tips/Importing_gmail_filters_in_mutt.txt"
               rel="nofollow">Show Source</a>
        </div>

        <div class="right">
          
    <div class="footer">
        &copy; <a href="../../copyright.html">Copyright</a> 2009-2014, James Rowe.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>